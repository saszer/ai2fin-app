<!-- Custom Wazuh Rules for Database Security -->
<!-- embracingearth.space - Database Attack Detection -->

<group name="database_security,">
  
  <!-- SQL Injection Attempt -->
  <rule id="100030" level="15">
    <match>sql_injection_attempt|SQL.*injection</match>
    <description>SQL injection attack attempt detected</description>
    <group>database_security,sql_injection,critical</group>
  </rule>
  
  <!-- NoSQL Injection Attempt -->
  <rule id="100031" level="15">
    <match>nosql.*injection|NoSQL.*injection</match>
    <description>NoSQL injection attack attempt detected</description>
    <group>database_security,nosql_injection,critical</group>
  </rule>
  
  <!-- Database Access Anomaly -->
  <rule id="100032" level="12">
    <match>database.*error|database.*access|connection.*refused</match>
    <description>Database access anomaly detected (potential attack)</description>
    <group>database_security,access_anomaly</group>
  </rule>
  
  <!-- Multiple Database Errors (Correlation Rule) -->
  <rule id="100039" level="14" frequency="10" timeframe="300">
    <if_matched_sid>100032</if_matched_sid>
    <description>Multiple database errors detected from same source (potential attack)</description>
    <group>database_security,access_anomaly,correlation</group>
  </rule>
  
  <!-- Neon Database Connection Issues -->
  <rule id="100033" level="10">
    <match>neon.*connection|connection.*closed|pool.*exhausted</match>
    <description>Neon database connection issue detected</description>
    <group>database_security,neon,connection</group>
  </rule>
  
  <!-- Unusual Database Query Pattern -->
  <rule id="100034" level="11">
    <match>suspicious.*query|unusual.*pattern|query.*anomaly</match>
    <description>Unusual database query pattern detected</description>
    <group>database_security,query_anomaly</group>
  </rule>
  
  <!-- Database Credential Brute Force -->
  <rule id="100035" level="13">
    <match>database.*authentication.*failed|connection.*authentication</match>
    <description>Database credential brute force attempt</description>
    <group>database_security,brute_force</group>
  </rule>
  
  <!-- Multiple Database Auth Failures (Correlation Rule) -->
  <rule id="100040" level="15" frequency="5" timeframe="60">
    <if_matched_sid>100035</if_matched_sid>
    <description>Multiple database authentication failures (brute force attack)</description>
    <group>database_security,brute_force,correlation</group>
  </rule>
  
  <!-- IDOR Attack (Insecure Direct Object Reference) -->
  <rule id="100036" level="12">
    <match>unauthorized.*access|access.*denied|forbidden.*resource</match>
    <description>IDOR attack attempt detected</description>
    <group>database_security,idor,logic_attack</group>
  </rule>
  
  <!-- Mass Assignment Attack -->
  <rule id="100037" level="11">
    <match>mass.*assignment|unauthorized.*field|privilege.*escalation</match>
    <description>Mass assignment attack attempt detected</description>
    <group>database_security,mass_assignment,logic_attack</group>
  </rule>
  
  <!-- Business Logic Bypass -->
  <rule id="100038" level="12">
    <match>logic.*bypass|validation.*bypass|rate.*limit.*circumvent</match>
    <description>Business logic bypass attempt detected</description>
    <group>database_security,logic_bypass,logic_attack</group>
  </rule>
  
</group>

